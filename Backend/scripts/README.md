# Скрипты миграции

## migrate_complex_images.py

Скрипт для миграции изображений жилых комплексов.

### Что делает скрипт:

1. Находит все комплексы без главного изображения (`main_image`)
2. Для каждого такого комплекса находит первое изображение из таблицы `Image`
3. Устанавливает это изображение как `main_image` комплекса

### Как запустить:

```bash
# Из корневой директории проекта
make migrate-images
```

Или напрямую:

```bash
docker-compose exec backend python scripts/migrate_complex_images.py
```

### Пример вывода:

```
Начинаем миграцию изображений комплексов...
============================================================
Найдено 5 комплексов без главного изображения
✓ Обновлен комплекс 'Назарбаев Резиденс' (ID: 1)
✓ Обновлен комплекс 'Алтын Булак' (ID: 2)
⚠ Пропущен комплекс 'Новый проект' (ID: 3) - нет изображений
✓ Обновлен комплекс 'Зеленый Квартал' (ID: 4)
✓ Обновлен комплекс 'Сункар' (ID: 5)

============================================================
Миграция завершена!
Обновлено комплексов: 4
Пропущено комплексов (без изображений): 1
============================================================
```

### Когда использовать:

- После обновления системы на новую версию с поддержкой главных изображений
- Если есть комплексы без установленного `main_image`
- Для автоматического заполнения поля `main_image` из существующих изображений

### Безопасность:

- Скрипт **НЕ удаляет** изображения из таблицы `Image`
- Скрипт только **копирует** URL первого изображения в поле `main_image`
- Можно запускать несколько раз - скрипт пропускает уже обновленные комплексы
- Все изменения сохраняются в одной транзакции с возможностью rollback при ошибке
